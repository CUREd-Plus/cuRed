-- Import ECDS data
CREATE TABLE hes_ecds AS
SELECT *
FROM read_csv('FILE*.txt',
        delim='|',
        header=true,
        -- Columns must be ordered
        columns={'ACCOMMODATION_STATUS': 'VARCHAR', 'ACCOMMODATION_STATUS_VALID': 'VARCHAR', 'ACUITY': 'VARCHAR', 'ACUITY_VALID_APPROVED': 'VARCHAR', 'AGE_AT_ARRIVAL': 'VARCHAR', 'ARRIVAL_DATE': 'VARCHAR', 'ARRIVAL_MODE': 'VARCHAR', 'ARRIVAL_MODE_VALID_APPROVED': 'VARCHAR', 'ARRIVAL_MONTH': 'VARCHAR', 'ARRIVAL_TIME': 'VARCHAR', 'ASSESSMENT_DATE': 'VARCHAR', 'ASSESSMENT_TIME': 'VARCHAR', 'ATTENDANCE_CATEGORY': 'VARCHAR', 'ATTENDANCE_SOURCE': 'VARCHAR', 'ATTENDANCE_SOURCE_ORGANISATION': 'VARCHAR', 'ATTENDANCE_SOURCE_VALID_APPROVED': 'VARCHAR', 'BIRTH_MONTH': 'VARCHAR', 'BIRTH_YEAR': 'VARCHAR', 'CHIEF_COMPLAINT': 'VARCHAR', 'CHIEF_COMPLAINT_EXTENDED_CODE': 'VARCHAR', 'CHIEF_COMPLAINT_VALID_APPROVED': 'VARCHAR', 'CLASSIFICATION_1': 'VARCHAR', 'CLASSIFICATION_2': 'VARCHAR', 'CLASSIFICATION_3': 'VARCHAR', 'CLASSIFICATION_4': 'VARCHAR', 'COMMISSIONER': 'VARCHAR', 'COMMISSIONER_DERIVED': 'VARCHAR', 'COMORBIDITIES_1': 'VARCHAR', 'COMORBIDITIES_10': 'VARCHAR', 'COMORBIDITIES_2': 'VARCHAR', 'COMORBIDITIES_3': 'VARCHAR', 'COMORBIDITIES_4': 'VARCHAR', 'COMORBIDITIES_5': 'VARCHAR', 'COMORBIDITIES_6': 'VARCHAR', 'COMORBIDITIES_7': 'VARCHAR', 'COMORBIDITIES_8': 'VARCHAR', 'COMORBIDITIES_9': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_1': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_10': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_2': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_3': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_4': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_5': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_6': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_7': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_8': 'VARCHAR', 'COMORBIDITIES_VALID_APPROVED_9': 'VARCHAR', 'CONCLUSION_DATE': 'VARCHAR', 'CONCLUSION_TIME': 'VARCHAR', 'CONCLUSION_TIME_SINCE_ARRIVAL': 'VARCHAR', 'CONVEYING_AMBULANCE_TRUST': 'VARCHAR', 'COSTING_PERIOD': 'VARCHAR', 'COUNTRY': 'VARCHAR', 'DECIDED_TO_ADMIT_DATE': 'VARCHAR', 'DECIDED_TO_ADMIT_TIME': 'VARCHAR', 'DECISION_TO_ADMIT_TIME_SINCE_ARRIVAL': 'VARCHAR', 'DEPARTMENT_TYPE': 'VARCHAR', 'DEPARTURE_DATE': 'VARCHAR', 'DEPARTURE_TIME': 'VARCHAR', 'DEPARTURE_TIME_SINCE_ARRIVAL': 'VARCHAR', 'DIAGNOSIS_CODE_1': 'VARCHAR', 'DIAGNOSIS_CODE_10': 'VARCHAR', 'DIAGNOSIS_CODE_11': 'VARCHAR', 'DIAGNOSIS_CODE_12': 'VARCHAR', 'DIAGNOSIS_CODE_2': 'VARCHAR', 'DIAGNOSIS_CODE_3': 'VARCHAR', 'DIAGNOSIS_CODE_4': 'VARCHAR', 'DIAGNOSIS_CODE_5': 'VARCHAR', 'DIAGNOSIS_CODE_6': 'VARCHAR', 'DIAGNOSIS_CODE_7': 'VARCHAR', 'DIAGNOSIS_CODE_8': 'VARCHAR', 'DIAGNOSIS_CODE_9': 'VARCHAR', 'DIAGNOSIS_FIRST_1': 'VARCHAR', 'DIAGNOSIS_FIRST_10': 'VARCHAR', 'DIAGNOSIS_FIRST_11': 'VARCHAR', 'DIAGNOSIS_FIRST_12': 'VARCHAR', 'DIAGNOSIS_FIRST_2': 'VARCHAR', 'DIAGNOSIS_FIRST_3': 'VARCHAR', 'DIAGNOSIS_FIRST_4': 'VARCHAR', 'DIAGNOSIS_FIRST_5': 'VARCHAR', 'DIAGNOSIS_FIRST_6': 'VARCHAR', 'DIAGNOSIS_FIRST_7': 'VARCHAR', 'DIAGNOSIS_FIRST_8': 'VARCHAR', 'DIAGNOSIS_FIRST_9': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_1': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_10': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_11': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_12': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_2': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_3': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_4': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_5': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_6': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_7': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_8': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_9': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_1': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_10': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_11': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_12': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_2': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_3': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_4': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_5': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_6': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_7': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_8': 'VARCHAR', 'DIAGNOSIS_QUALIFIER_IS_APPROVED_9': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_1': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_10': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_11': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_12': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_2': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_3': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_4': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_5': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_6': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_7': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_8': 'VARCHAR', 'DIAGNOSIS_VALID_APPROVED_9': 'VARCHAR', 'DISCHARGE_DESTINATION': 'VARCHAR', 'DISCHARGE_DESTINATION_VALID_APPROVED': 'VARCHAR', 'DISCHARGE_FOLLOW_UP': 'VARCHAR', 'DISCHARGE_FOLLOW_UP_VALID_APPROVED': 'VARCHAR', 'DISCHARGE_INFORMATION_GIVEN': 'VARCHAR', 'DISCHARGE_INFORMATION_GIVEN_VALID_APPROVED': 'VARCHAR', 'DISCHARGE_STATUS': 'VARCHAR', 'DISCHARGE_STATUS_VALID_APPROVED': 'VARCHAR', 'DRUG_ALCOHOL_CODE_1': 'VARCHAR', 'DRUG_ALCOHOL_CODE_2': 'VARCHAR', 'DRUG_ALCOHOL_CODE_3': 'VARCHAR', 'DRUG_ALCOHOL_CODE_4': 'VARCHAR', 'DRUG_ALCOHOL_CODE_VALID_APPROVED_1': 'VARCHAR', 'DRUG_ALCOHOL_CODE_VALID_APPROVED_2': 'VARCHAR', 'DRUG_ALCOHOL_CODE_VALID_APPROVED_3': 'VARCHAR', 'DRUG_ALCOHOL_CODE_VALID_APPROVED_4': 'VARCHAR', 'ED_COUNTY_CODE': 'VARCHAR', 'ED_DISTRICT_CODE': 'VARCHAR', 'EPIKEY': 'VARCHAR', 'ETHNIC_CATEGORY': 'VARCHAR', 'EXCLUDED': 'VARCHAR', 'EXCLUSION_REASONS': 'VARCHAR', 'EXPIRY_DATE_1': 'VARCHAR', 'EXPIRY_DATE_2': 'VARCHAR', 'EXPIRY_DATE_3': 'VARCHAR', 'EXPIRY_DATE_4': 'VARCHAR', 'EXPIRY_TIME_1': 'VARCHAR', 'EXPIRY_TIME_2': 'VARCHAR', 'EXPIRY_TIME_3': 'VARCHAR', 'EXPIRY_TIME_4': 'VARCHAR', 'FINAL_PRICE': 'VARCHAR', 'FRACTIONAL_AGE_AT_ARRIVAL': 'VARCHAR', 'GROUPER_VERSION': 'VARCHAR', 'HEALTH_RESOURCE_GROUP': 'VARCHAR', 'INITIAL_ASSESSMENT_TIME_SINCE_ARRIVAL': 'VARCHAR', 'INJURY_ACTIVITY_STATUS': 'VARCHAR', 'INJURY_ACTIVITY_STATUS_VALID_APPROVED': 'VARCHAR', 'INJURY_ACTIVITY_TYPE': 'VARCHAR', 'INJURY_ACTIVITY_TYPE_VALID_APPROVED': 'VARCHAR', 'INJURY_DATE': 'VARCHAR', 'INJURY_INTENT': 'VARCHAR', 'INJURY_INTENT_VALID_APPROVED': 'VARCHAR', 'INJURY_MECHANISM': 'VARCHAR', 'INJURY_MECHANISM_VALID_APPROVED': 'VARCHAR', 'INJURY_TIME': 'VARCHAR', 'INVESTIGATION_CODE_1': 'VARCHAR', 'INVESTIGATION_CODE_10': 'VARCHAR', 'INVESTIGATION_CODE_11': 'VARCHAR', 'INVESTIGATION_CODE_12': 'VARCHAR', 'INVESTIGATION_CODE_2': 'VARCHAR', 'INVESTIGATION_CODE_3': 'VARCHAR', 'INVESTIGATION_CODE_4': 'VARCHAR', 'INVESTIGATION_CODE_5': 'VARCHAR', 'INVESTIGATION_CODE_6': 'VARCHAR', 'INVESTIGATION_CODE_7': 'VARCHAR', 'INVESTIGATION_CODE_8': 'VARCHAR', 'INVESTIGATION_CODE_9': 'VARCHAR', 'INVESTIGATION_DATE_1': 'VARCHAR', 'INVESTIGATION_DATE_10': 'VARCHAR', 'INVESTIGATION_DATE_11': 'VARCHAR', 'INVESTIGATION_DATE_12': 'VARCHAR', 'INVESTIGATION_DATE_2': 'VARCHAR', 'INVESTIGATION_DATE_3': 'VARCHAR', 'INVESTIGATION_DATE_4': 'VARCHAR', 'INVESTIGATION_DATE_5': 'VARCHAR', 'INVESTIGATION_DATE_6': 'VARCHAR', 'INVESTIGATION_DATE_7': 'VARCHAR', 'INVESTIGATION_DATE_8': 'VARCHAR', 'INVESTIGATION_DATE_9': 'VARCHAR', 'INVESTIGATION_TIME_1': 'VARCHAR', 'INVESTIGATION_TIME_10': 'VARCHAR', 'INVESTIGATION_TIME_11': 'VARCHAR', 'INVESTIGATION_TIME_12': 'VARCHAR', 'INVESTIGATION_TIME_2': 'VARCHAR', 'INVESTIGATION_TIME_3': 'VARCHAR', 'INVESTIGATION_TIME_4': 'VARCHAR', 'INVESTIGATION_TIME_5': 'VARCHAR', 'INVESTIGATION_TIME_6': 'VARCHAR', 'INVESTIGATION_TIME_7': 'VARCHAR', 'INVESTIGATION_TIME_8': 'VARCHAR', 'INVESTIGATION_TIME_9': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_1': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_10': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_11': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_12': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_2': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_3': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_4': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_5': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_6': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_7': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_8': 'VARCHAR', 'INVESTIGATIONS_VALID_APPROVED_9': 'VARCHAR', 'LSOA_2011': 'VARCHAR', 'MARKET_FORCES_ADJUSTMENT': 'VARCHAR', 'MARKET_FORCES_FACTOR': 'VARCHAR', 'NHS_NUMBER_STATUS_INDICATOR_CODE': 'VARCHAR', 'ORGANISATION_CODE_PATIENT_PATHWAY_IDENTIFIER': 'VARCHAR', 'OVERSEAS_VISITOR_CHARGING_CATEGORY': 'VARCHAR', 'PATIENT_POSTCODE_DISTRICT': 'VARCHAR', 'PATIENT_TYPE': 'VARCHAR', 'PDS_GENERAL_PRACTICE': 'VARCHAR', 'PERIOD_END_DATE': 'VARCHAR', 'PERIOD_LENGTH': 'VARCHAR', 'PERIOD_START_DATE': 'VARCHAR', 'PERIOD_STATUS': 'VARCHAR', 'PLACE_OF_INJURY': 'VARCHAR', 'PLACE_OF_INJURY_VALID_APPROVED': 'VARCHAR', 'PRACTICE_CODE_PATIENT_REGISTRATION': 'VARCHAR', 'PREFERRED_SPOKEN_LANGUAGE': 'VARCHAR', 'PREFERRED_SPOKEN_LANGUAGE_VALID': 'VARCHAR', 'PROVIDER_CODE': 'VARCHAR', 'PROVIDER_CODE_DERIVED': 'VARCHAR', 'PROVIDER_POSTCODE_DISTRICT': 'VARCHAR', 'RECEIVING_SITE': 'VARCHAR', 'REFERRAL_ASSESSMENT_DATE_1': 'VARCHAR', 'REFERRAL_ASSESSMENT_DATE_2': 'VARCHAR', 'REFERRAL_ASSESSMENT_DATE_3': 'VARCHAR', 'REFERRAL_ASSESSMENT_DATE_4': 'VARCHAR', 'REFERRAL_ASSESSMENT_TIME_1': 'VARCHAR', 'REFERRAL_ASSESSMENT_TIME_2': 'VARCHAR', 'REFERRAL_ASSESSMENT_TIME_3': 'VARCHAR', 'REFERRAL_ASSESSMENT_TIME_4': 'VARCHAR', 'REFERRED_TO_SERVICE_1': 'VARCHAR', 'REFERRED_TO_SERVICE_2': 'VARCHAR', 'REFERRED_TO_SERVICE_3': 'VARCHAR', 'REFERRED_TO_SERVICE_4': 'VARCHAR', 'REFERRED_TO_SERVICE_VALID_APPROVED_1': 'VARCHAR', 'REFERRED_TO_SERVICE_VALID_APPROVED_2': 'VARCHAR', 'REFERRED_TO_SERVICE_VALID_APPROVED_3': 'VARCHAR', 'REFERRED_TO_SERVICE_VALID_APPROVED_4': 'VARCHAR', 'RESIDENCE_CCG': 'VARCHAR', 'RESIDENCE_CCG_FROM_PATIENT_POSTCODE': 'VARCHAR', 'SEEN_DATE': 'VARCHAR', 'SEEN_FOR_TREATMENT_TIME_SINCE_ARRIVAL': 'VARCHAR', 'SEEN_TIME': 'VARCHAR', 'SEQUENCE_NUMBER_1': 'VARCHAR', 'SEQUENCE_NUMBER_10': 'VARCHAR', 'SEQUENCE_NUMBER_11': 'VARCHAR', 'SEQUENCE_NUMBER_12': 'VARCHAR', 'SEQUENCE_NUMBER_2': 'VARCHAR', 'SEQUENCE_NUMBER_3': 'VARCHAR', 'SEQUENCE_NUMBER_4': 'VARCHAR', 'SEQUENCE_NUMBER_5': 'VARCHAR', 'SEQUENCE_NUMBER_6': 'VARCHAR', 'SEQUENCE_NUMBER_7': 'VARCHAR', 'SEQUENCE_NUMBER_8': 'VARCHAR', 'SEQUENCE_NUMBER_9': 'VARCHAR', 'SERVICE_REQUEST_DATE_1': 'VARCHAR', 'SERVICE_REQUEST_DATE_2': 'VARCHAR', 'SERVICE_REQUEST_DATE_3': 'VARCHAR', 'SERVICE_REQUEST_DATE_4': 'VARCHAR', 'SERVICE_REQUEST_TIME_1': 'VARCHAR', 'SERVICE_REQUEST_TIME_2': 'VARCHAR', 'SERVICE_REQUEST_TIME_3': 'VARCHAR', 'SERVICE_REQUEST_TIME_4': 'VARCHAR', 'SHA_PROVIDER': 'VARCHAR', 'SITE': 'VARCHAR', 'START_DATE_1': 'VARCHAR', 'START_DATE_2': 'VARCHAR', 'START_DATE_3': 'VARCHAR', 'START_DATE_4': 'VARCHAR', 'START_TIME_1': 'VARCHAR', 'START_TIME_2': 'VARCHAR', 'START_TIME_3': 'VARCHAR', 'START_TIME_4': 'VARCHAR', 'STATED_GENDER': 'VARCHAR', 'TARIFF': 'VARCHAR', 'TARIFF_DESCRIPTION': 'VARCHAR', 'TOKEN_PERSON_ID': 'VARCHAR', 'TREATMENT_CODE_1': 'VARCHAR', 'TREATMENT_CODE_10': 'VARCHAR', 'TREATMENT_CODE_11': 'VARCHAR', 'TREATMENT_CODE_12': 'VARCHAR', 'TREATMENT_CODE_2': 'VARCHAR', 'TREATMENT_CODE_3': 'VARCHAR', 'TREATMENT_CODE_4': 'VARCHAR', 'TREATMENT_CODE_5': 'VARCHAR', 'TREATMENT_CODE_6': 'VARCHAR', 'TREATMENT_CODE_7': 'VARCHAR', 'TREATMENT_CODE_8': 'VARCHAR', 'TREATMENT_CODE_9': 'VARCHAR', 'TREATMENT_DATE_1': 'VARCHAR', 'TREATMENT_DATE_10': 'VARCHAR', 'TREATMENT_DATE_11': 'VARCHAR', 'TREATMENT_DATE_12': 'VARCHAR', 'TREATMENT_DATE_2': 'VARCHAR', 'TREATMENT_DATE_3': 'VARCHAR', 'TREATMENT_DATE_4': 'VARCHAR', 'TREATMENT_DATE_5': 'VARCHAR', 'TREATMENT_DATE_6': 'VARCHAR', 'TREATMENT_DATE_7': 'VARCHAR', 'TREATMENT_DATE_8': 'VARCHAR', 'TREATMENT_DATE_9': 'VARCHAR', 'TREATMENT_FUNCTION_CODE': 'VARCHAR', 'TREATMENT_TIME_1': 'VARCHAR', 'TREATMENT_TIME_10': 'VARCHAR', 'TREATMENT_TIME_11': 'VARCHAR', 'TREATMENT_TIME_12': 'VARCHAR', 'TREATMENT_TIME_2': 'VARCHAR', 'TREATMENT_TIME_3': 'VARCHAR', 'TREATMENT_TIME_4': 'VARCHAR', 'TREATMENT_TIME_5': 'VARCHAR', 'TREATMENT_TIME_6': 'VARCHAR', 'TREATMENT_TIME_7': 'VARCHAR', 'TREATMENT_TIME_8': 'VARCHAR', 'TREATMENT_TIME_9': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_1': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_10': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_11': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_12': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_2': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_3': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_4': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_5': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_6': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_7': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_8': 'VARCHAR', 'TREATMENTS_VALID_APPROVED_9': 'VARCHAR', 'WAITING_TIME_MEASUREMENT_TYPE': 'VARCHAR'}
  );

-- Convert data types
--ALTER TABLE hes_ecds ADD COLUMN seen_date_bak VARCHAR;
--UPDATE hes_ecds SET seen_date_bak = seen_date;
ALTER TABLE hes_ecds ALTER seen_date SET DATA TYPE DATE USING CAST(NULLIF(seen_date, '1900-01-01') AS DATE);
ALTER TABLE hes_ecds ALTER departure_date SET DATA TYPE DATE USING CAST(NULLIF(departure_date, '1900-01-01') AS DATE);
ALTER TABLE hes_ecds ALTER arrival_date SET DATA TYPE DATE USING CAST(NULLIF(arrival_date, '1900-01-01') AS DATE);
ALTER TABLE hes_ecds ALTER conclusion_date SET DATA TYPE DATE USING CAST(NULLIF(conclusion_date, '1900-01-01') AS DATE);

-- Arrival date
ALTER TABLE hes_ecds ADD COLUMN IF NOT EXISTS arrival_year USMALLINT;
UPDATE hes_ecds SET arrival_year = YEAR(arrival_date);
ALTER TABLE hes_ecds ADD COLUMN IF NOT EXISTS arrival_month_of_year UTINYINT;
UPDATE hes_ecds SET arrival_month_of_year = MONTH(arrival_date);
ALTER TABLE hes_ecds ADD COLUMN IF NOT EXISTS arrival_month VARCHAR;
UPDATE hes_ecds SET arrival_month = STRFTIME(arrival_date, '%Y-%m');
