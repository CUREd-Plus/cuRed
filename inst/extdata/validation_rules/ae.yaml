---
# Accident and Emergency (A&E) data validation rules

rules:
# AEKEY	Record identifier of the A&E attendance
- name: AEKEY is required
  expr: '!is.na(AEKEY)'
  meta:
    severity: error
  
- name: AEKEY is unique
  expr: is_unique(AEKEY)
  meta:
    severity: error

- name: AEKEY 12n
  description: Numeric length 12 (2013-14 to 2020-21)
  expr: grepl("^\\d{12}$", AEKEY)

- name: AEKEY 19n
  description: Numeric length 19 (2021-22 onwards)
  expr: grepl("^\\d{19}$", AEKEY)

# TOKEN_PERSON_ID
- name: TOKEN_PERSON_ID is required
  expr: '!is.na(TOKEN_PERSON_ID)'
  meta:
    severity: error
    
- name: TOKEN_PERSON_ID is VARCHAR(32)
  description: TOKEN_PERSON_ID is alphanumeric with length 32
  expr: grepl("^[a-zA-Z0-9]{32}$", TOKEN_PERSON_ID)
  meta:
    severity: error

# STUDY_ID person cohort identifier
- name: STUDY_ID is required
  expr: '!is.na(STUDY_ID)'
  meta:
    severity: error

# SUSRECID SUS Record Identifier
# SUS (Secondary Uses Service)-generated record identifier
- name: SUSRECID 14n
  description: SUSRECID is a number with 14 integers (2007-08 onwards)
  expr: grepl("^\\d{14}$", SUSRECID)

# LSOA01 Lower Super Output Area of Residence 2001
- name: LSOA01 9an
  description: LSOA01 Alphanumeric length 9
  expr: grepl("^[A-Z0-9]{9}$", LSOA01)

# LSOA11 Lower Super Output Area of Residence 2011
- name: LSOA11 9an
  description: LSOA11 Alphanumeric length 9.
  expr: grepl("^[A-Z0-9]{9}$", LSOA11)

# EPIKEY APC record identifier (optional)
- name: EPIKEY 19n
  description: EPIKEY has 19 integers (2021-22 onwards)
  expr: grepl("^\\d{19}$", EPIKEY)

- name: EPIKEY 12n
  description: EPIKEY has 12 integers (2013-14 to 2020-21)
  expr: grepl("^\\d{12}$", EPIKEY)
...
